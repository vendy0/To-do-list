<!-- @format -->

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" conent="ie=edge" />
		<title>Document</title>
		<link rel="stylesheet" href="style.css" type="text/css" media="all" />
		<style type="text/css" media="all">
			#unordered-list {
				list-style-type: none;
			}
		</style>
	</head>
	<body>
		<header>
			<h1>To do list</h1>
			<ul>
				<li>Listez</li>
				<li>Planifier</li>
				<li>Organisez</li>
			</ul>
		</header>
		<hr />
		<main>
			<ul id="unordered-list">
				<li id="placeholder"
					><input type="checkbox" name="" id="" />...</li
				>
			</ul>
			<input
				type="text"
				name="enter-task-input"
				id="enter-task-input"
				value=""
				placeholder="Entrez une tâche..." />
			<button id="add-task-button" type="submit">Ajouter</button>
			<button id="delete-a-task-button" type="submit" data-mode="saveMode"
				>Supprimer une tâche</button
			>
			<button id="delete-all-task-button" type="submit"
				>Supprimer toutes les tâches</button
			>
		</main>
		<footer> </footer>

		<script>
			// LES VARIABLES
			const unorderedList = document.getElementById("unordered-list");
			const placeholder = document.getElementById("placeholder");
			const enterTaskInput = document.getElementById("enter-task-input");
			const addTaskButton = document.getElementById("add-task-button");
			const deleteATaskButton = document.getElementById(
				"delete-a-task-button"
			);
			const deleteAllTaskButton = document.getElementById(
				"delete-all-task-button"
			);
			var inSaveMode = true;

			/*
			 * LES FONCTIONS
			 */
			// Fonction pour ajouter des tâches :
			function createNewTask(task) {
				let li = document.createElement("li");
				let checkbox = document.createElement("input");
				checkbox.type = "checkbox";
				li.appendChild(checkbox);
				li.appendChild(document.createTextNode(" " + task));
				unorderedList.appendChild(li);

				enterTaskInput.value = "";
				enterTaskInput.focus();
			}

			// Fonction pour Sauvegarder les tâches dans le localStorage
			function storeTask(task) {
				let taskListStored = JSON.parse(
					localStorage.getItem("taskList") || "[]"
				);
				let object1 = {};
				object1.label = task;
				object1.statut = "unchecked";
				object1.category = "none";
				taskListStored.push(object1);
				localStorage.setItem(
					"taskList",
					JSON.stringify(taskListStored)
				);
			}

			// Fonction pour virer les accents et la casse
			function normalizeText(text) {
				return text
					.normalize("NFD") // Décompose les accents
					.replace(/[\u0300-\u036f]/g, "") // Supprime les diacritiques
					.toUpperCase(); // Insensible à la casse
			}

			/*
			 * FONCTION POUR VÉRIFIER LA TÂCHE ENTRÉE
			 * Vérifie si l'entrée n'est pas vide
			 * Vérifie si la tâche n'existe pas déjà
			 */
			function taskVerification(task) {
				let found = false;
				for (let li of unorderedList.querySelectorAll("li")) {
					if (
						normalizeText(li.textContent.trim()) ===
						normalizeText(task)
					) {
						found = true;
						break;
					}
				}
				if (!task) {
					alert("Entrez une tâche valide !");
					return false;
				} else if (found) {
					alert("Cette tâche existe déjà !");
					enterTaskInput.value = "";
					return false;
				} else {
					return true;
				}
			}

			/*
			 * Fonction pour Changer de mode save / delete.
			 * Changer de mode
			 * Désactiver l'input et les boutons
			 */
			function toggleDeleteMode() {
				if (deleteATaskButton.dataset.mode == "saveMode") {
					deleteATaskButton.dataset.mode = "deleteMode";
					deleteATaskButton.textContent = "Terminé";
					addTaskButton.disabled = true;
					enterTaskInput.disabled = true;
					deleteAllTaskButton.disabled = true;
				} else {
					deleteATaskButton.dataset.mode = "saveMode";
					deleteATaskButton.textContent = "Supprimer une tâche";
					addTaskButton.disabled = false;
					enterTaskInput.disabled = false;
					deleteAllTaskButton.disabled = false;
					unorderedList.querySelectorAll("li").forEach((li) => {
						li.classList.remove("delete-mode");
						let clone = li.cloneNode(true);
						li.replaceWith(clone);
					});
				}

				var inSaveMode =
					deleteATaskButton.dataset.mode === "saveMode"
						? true
						: false;

				if (!inSaveMode) {
					unorderedList.querySelectorAll("li").forEach((task) => {
						task.addEventListener("click", () => {
							let hasConfirmed = false;
							hasConfirm = confirm(
								`Voulez-vous vraiment supprimer cette élément de la liste : ${task.textContent.trim()} ?`
							);
							if (hasConfirm) {
								let index = task.findIndex((t) => t === label);
								if (index != -1) tasks.splice(index, 1);
								localStorage.setItem(
									"taskList",
									JSON.stringify(tasks)
								);
								child.remove();
								taskList = tasks;
							}
						});
					});
				} else {
					return;
				}
			}

			// Fonction pour supprimer des éléments

			// Ajouter avec la touche entrer
			enterTaskInput.addEventListener("keypress", (e) => {
				if (e.key === "Enter") addTaskButton.click();
			});

			// Recupérer le localStorage et placer les tâches
			let taskListStored = JSON.parse(
				localStorage.getItem("taskList") || "[]"
			);
			if (taskListStored) {
				taskListStored.forEach((task) => {
					createNewTask(task.label);
				});
			}

			// Ajouter des tâches au clic.
			addTaskButton.addEventListener("click", () => {
				let taskListDisplay = unorderedList.querySelectorAll("li");
				let newTask = enterTaskInput.value.trim();
				let inputIsOkay = taskVerification(newTask);
				if (!inputIsOkay) return;
				createNewTask(newTask);
				storeTask(newTask);
			});

			// Supprimer un élément
			deleteATaskButton.addEventListener("click", () => {
				toggleDeleteMode();
			});
		</script>
	</body>
</html>
